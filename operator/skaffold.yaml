apiVersion: skaffold/v2beta28
kind: Config
metadata:
  name: operator
requires:
    - configs: ["operator-dependencies"]
profiles:
  - name: use-operator
    build:
      artifacts:
        - image: opennms/operator
          context: operator
          docker:
            dockerfile: Dockerfile
          hooks:
            before:
              - command: [ "make", "copy-charts" ]
                dir: operator
    deploy:
      helm:
        releases:
          - name: opennms-operator
            namespace: opennms
            createNamespace: true
            chartPath: charts/opennms-operator
            valuesFiles:
              - operator/values.yaml
            artifactOverrides:
              Operator.image: opennms/operator

---

apiVersion: skaffold/v2beta28
kind: Config
metadata:
  name: operator-dependencies
profiles:
  - name: use-operator
    deploy:
      helm:
        releases:
          - name: opennms-operator-dependencies
            chartPath: charts/opennms-operator-dependencies
