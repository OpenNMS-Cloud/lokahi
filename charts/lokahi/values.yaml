hostname: onmshs
port: 443 #set depending on tls.enabled and the ingress ports, do not change
protocol: https #set depending on tls.enabled, do not change
OpenNMS: # we might be able to remove this
  global:
    imagePullPolicy: IfNotPresent
    databaseName: "desenv"
    databaseHost: "postgres"
    privateRepoEnabled: false
    image:
      repository: opennms
      tag: latest
    springBoot:
      configMapName: spring-boot-app-config
      configMapVolumeName: spring-boot-app-config-volume
      mountPath: "/app/config"
      env: {}
    kafkaClient:
      bootstrapServers: onms-kafka:9092
    enableJsonLogging: false
    openTelemetry:
      otlpTracesEndpoint: ""
      env:
        OTEL_PROPAGATORS: tracecontext,baggage,jaeger
  api:
    path: /api
    serviceName: opennms-rest-server
    imageShortName: lokahi-rest-server
    replicas: 1
    resources:
      limits:
        cpu: "1"
        memory: 2Gi # MaxRAMPercentage=50,avg-usage=245MB
      requests:
        cpu: "1"
        memory: 2Gi
    flowsUrl: SOME-EXTERNAL-FLOW-SERVER:80
    flowsTlsEnabled: false
    certificateManagerUrl: ""
    packagedminionFile: run-minion-docker-compose.yaml
    minionEndpoint: host.docker.internal
    introspectionEnabled: false
    maxAliasOccurrence: 5
    maxComplexity: 60
    maxDirectiveOccurrence: 5
    maxFieldOccurrence: 5
    maxQueryDepth: 5
    playgroundGuiEnabled: false
    ports: 
      - name: http
        containerPort: 8080
      - name: grpc
        containerPort: 9090
    serviceType: NodePort
  metricsProcessor:
    serviceName: opennms-metrics-processor
    imageShortName: lokahi-metrics-processor
    replicas: 1
    resources:
      limits:
        cpu: "2"
        memory: 4Gi # MaxRAMPercentage=50,avg-usage=400MB
      requests:
        cpu: "1"
        memory: 2Gi
    flowIngestorUrl: SOME-EXTERNAL-FLOW-SERVER:80
    flowTlsEnabled: false
    kafkaSecretName: ~
    ports: 
      - name: http
        containerPort: 8080
  ui:
    path: /
    serviceName: opennms-ui
    tlsSecretName: opennms-ui-certificate
    imageShortName: lokahi-ui
    replicas: 1
    port: 8080
    resources:
      limits:
        cpu: "1"
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
    ingressAnnotations:
      nginx.ingress.kubernetes.io/configuration-snippet: |
        add_header X-Content-Type-Options "nosniff";
        add_header X-Frame-Options "sameorigin";
        add_header server_tokens "off";
      nginx.ingress.kubernetes.io/client-body-buffer-size: 4k
      nginx.ingress.kubernetes.io/client-header-buffer-size: 4k
      nginx.ingress.kubernetes.io/large-client-header-buffers: 4 16k
      nginx.ingress.kubernetes.io/proxy-body-size: 4m
      nginx.ingress.kubernetes.io/proxy-buffer-size: 6k
    serviceType: NodePort
  minion:
    enabled: false
    serviceName: opennms-minion
    imageShortName: lokahi-minion
    replicas: 1
    port: 8181
    sshPort: 8101
    TrapsListenerPort: 1162
    netflow5ListenerPort: 8877
    netflow9ListenerPort: 4729
    netflowListenerPort: 9999
    resources:
      limits:
        cpu: "2"
        memory: 4Gi
      requests:
        cpu: "1"
        memory: 2Gi
    extraVolumes: []
    extraMounts: []
    extraInitContainers: []
    addDefaultLocation: false
  minionGateway:
    serviceName: opennms-minion-gateway
    tlsSecretName: opennms-minion-gateway-certificate
    imageShortName: lokahi-minion-gateway
    replicas: 1
    useKubernetes: "true"
    databaseSchemaName: "minion_gateway"
    resources:
      limits:
        cpu: "2"
        memory: 4Gi # MaxRAMPercentage=40 for heap (avg-usage=480MB) plus up to 2GB off-heap (4 Ignite Data Regions)
      requests:
        cpu: "1"
        memory: 2Gi
    ingressAnnotations:
      nginx.ingress.kubernetes.io/proxy-body-size: "0" # To avoid HTTP 413 and "client intended to send too large chunked body: X bytes while sending request to upstream"
      nginx.ingress.kubernetes.io/auth-tls-secret: lokahi/client-root-ca-certificate
      nginx.ingress.kubernetes.io/auth-tls-verify-client: "on"
      nginx.ingress.kubernetes.io/auth-tls-verify-depth: "1"
      nginx.ingress.kubernetes.io/auth-url: "http://opennms-minion-certificate-verifier.lokahi.svc.cluster.local:8080/certificate/debug"
      nginx.ingress.kubernetes.io/auth-response-headers: "tenant-id, location-id"
      nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream: true
      nginx.ingress.kubernetes.io/server-snippet: |
        grpc_read_timeout "1200s";
        grpc_send_timeout "1200s";
        client_body_timeout "1200s";
    kafkaSecretName: ~ #move to global
    ports:
      http:
        containerPort: 8080
      grpc:
        containerPort: 8990
      internalGrpc:
        containerPort: 8991
      igClient:
        containerPort: 10800
      igDiscovery:
        containerPort: 47500
      igSpi:
        containerPort: 47100

  inventory:
    serviceName: opennms-inventory
    imageShortName: lokahi-inventory
    replicas: 1
    databaseSchemaName: "inventory"
    resources:
      limits:
        cpu: "2"
        memory: 4Gi # MaxRAMPercentage=50,avg-usage=620MB
      requests:
        cpu: "1"
        memory: 2Gi
    encryptionKey: ~
    kafkaSecretName: ~
    ports: 
      - name: http
        containerPort: 8080
      - name: grpc
        containerPort: 6565
    serviceType: ClusterIP

  alert:
    serviceName: opennms-alert
    imageShortName: lokahi-alert
    replicas: 1
    databaseSchemaName: "alert"
    resources:
      limits:
        cpu: "2"
        memory: 4Gi # MaxRAMPercentage=50,avg-usage=480MB
      requests:
        cpu: "1"
        memory: 2Gi
    kafkaSecretName: ~
    ports: 
      - name: http
        containerPort: 8080
      - name: grpc
        containerPort: 6565
    serviceType: ClusterIP

  notification:
    serviceName: opennms-notifications
    imageShortName: lokahi-notification
    replicas: 1
    databaseSchemaName: "notification"
    resources:
      limits:
        cpu: "2"
        memory: 4Gi # MaxRAMPercentage=50,avg-usage=450MB
      requests:
        cpu: "1"
        memory: 2Gi
    kafkaSecretName: ~
    retry:
      delay: 1000
      maxDelay: 60000
      multiplier: 2
      max: 10
    acsConnectionSecretName: {} # the ACS connection string is expected in the 'connection-string' key
    baseUrl:
      url: "onmshs.local:443"
      appendTenantId: false
    ports: 
      - name: http
        containerPort: 8080
      - name: grpc
        containerPort: 6565
    serviceType: ClusterIP
  events:
    serviceName: opennms-events
    imageShortName: lokahi-events
    replicas: 1
    databaseSchemaName: "events"
    resources:
      limits:
        cpu: "2"
        memory: 4Gi # MaxRAMPercentage=50,avg-usage=550MB
      requests:
        cpu: "1"
        memory: 2Gi
    ports: 
      - name: http
        containerPort: 8080
      - name: grpc
        containerPort: 6565
    serviceType: ClusterIP
  dataChoices:
    serviceName: opennms-datachoices
    imageShortName: lokahi-datachoices
    replicas: 1
    databaseSchemaName: "datachoices"
    resources:
      limits:
        cpu: "1"
        memory: 1Gi
      requests:
        cpu: "1"
        memory: 1Gi
    ports: 
      - name: http
        containerPort: 8080
      - name: grpc
        containerPort: 6565
    serviceType: ClusterIP
  minionCertificateManager:
    enabled: false
    serviceName: opennms-minion-certificate-manager
    caSecretName: ""
    mtlsSecretName: opennms-minion-certificate
    imageShortName: lokahi-minion-certificate-manager
    replicas: 1
    volumeSize: 1Gi
    resources:
      limits:
        cpu: "1"
        memory: 1Gi
      requests:
        cpu: "1"
        memory: 1Gi
    ports: 
      - name: grpc
        containerPort: 8990
    serviceType: ClusterIP
  minionCertificateVerifier:
    serviceName: opennms-minion-certificate-verifier
    imageShortName: lokahi-minion-certificate-verifier
    replicas: 1
    resources:
      limits:
        cpu: "1"
        memory: 1Gi # MaxRAMPercentage=50,avg-usage=245MB
      requests:
        cpu: "1"
        memory: 1Gi
    certificateManagerUrl: ""
    ports: 
      - name: http
        containerPort: 8080
    serviceType: ClusterIP
citus:
  enabled: false
  adminUser: desenv
  adminPassword: notset
keycloak:
  path: /auth
  port: 8080
  httpsPort: 8443
  serviceName: onms-keycloak
  realmName: opennms
grafana:
  enabled: true
  path: /grafana
  port: 3000
  serviceName: grafana
cortexClient:
  hostRead: cortex
  hostWrite: cortex
  pathRead: /prometheus/api/v1
  pathWrite: /api/v1/push
  protocol: http
  portRead: 9000
  portWrite: 9000
nodeRestrictions: # will be applied to every pod in the instance
  enabled: false
  key: kubernetes.azure.com/scalesetpriority
  value: spot
tls:
  enabled: true
  # When Certificate Generation option is set to false you need to manually prepare secrets which are referred by
  # this helm chart. This includes creation of tls certificates for ingress but also for mutual tls between minions and
  # minion-gateway service
  certificateGeneration: false

ingress:
  enabled: false
  defaultEndpointsEnabled: true
  httpPort: 80
  httpsPort: 443
  webhookPort: 8443
  grpcPort: 8990
  controllerimage: registry.k8s.io/ingress-nginx/controller:v1.7.0@sha256:7612338342a1e7b8090bef78f2a04fffcadd548ccaabe8a47bf7758ff549a5f7
  secretJobimage: registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660
  webhookPatchJobimage: registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660
  resources:
    requests:
      cpu: 100m
      memory: 90Mi
  controllerService:
  type: ClusterIP
  ports:
    - appProtocol: https
      name: https-webhook
      port: 443
      targetPort: webhook
  controllerServiceNodePort:
    type: NodePort
    ports:
      - name: grpc
        protocol: TCP
        nodePort: 30990
        port: 8990


customErrors:
  image: quay.io/kubernetes-ingress-controller/custom-error-pages:0.4
  debug: true
  port: 8080
  httpPort: 80

prometheus:
  enabled: true
  path: /prometheus
  serviceName: prometheus
  port: 9090
  scrape: "true"  
  prometheusPort: "8080"
  prometheusPath: "/actuator/prometheus"

livenessProbe:
  path: "/actuator/health/liveness"
  healthzpath: "/healthz"
  port: "http"
  scheme: "HTTP"
  ingressPort: 10254

readinessProbe:
  path: "/actuator/health/readiness"
  healthzpath: "/healthz"
  port: "http"
  scheme: "HTTP"
  ingressPort: 10254
